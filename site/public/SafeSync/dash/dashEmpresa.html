<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="imagem/png" href="../assets/img/logotipo.svg" />
    <link rel="stylesheet" href="dashEmpresa.css" />
    <link rel="stylesheet" href="../assets/css/styleCadFunc.css" />
    <link rel="stylesheet" href="../assets/css/styleDashEmpresa.css" />
    <link rel="stylesheet" href="tarefas.css" />
    <link rel="stylesheet" href="../assets/css/styleGerFunc.css" />
    <script src="./script/gerenFunc.js"></script>
    <title>Dashboard</title>
</head>

<body>
    <main>
        <article>
            <nav class="menu-lateral" id="botao-expandir">
                <div class="botao_expandir">
                    <!-- <i class="bi bi-music-note-list" id="botao-expandir"></i> -->
                    <img src="../assets/img/logotipo.svg" alt="" width="60px" />
                </div>
                <ul>
                    <li class="item-menu ativo" id="dash-link">
                        <a href="#">
                            <span class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="1.5em" fill="currentColor"
                                    class="bi bi-clipboard2-data" viewBox="0 0 16 16">
                                    <path
                                        d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5h3Z" />
                                    <path
                                        d="M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-12Z" />
                                    <path
                                        d="M10 7a1 1 0 1 1 2 0v5a1 1 0 1 1-2 0V7Zm-6 4a1 1 0 1 1 2 0v1a1 1 0 1 1-2 0v-1Zm4-3a1 1 0 0 0-1 1v3a1 1 0 1 0 2 0V9a1 1 0 0 0-1-1Z" />
                                </svg>
                            </span>
                            <span class="txt-link dash-link">Dashboard</span>
                        </a>
                    </li>
                    <li class="item-menu" id="funcionario">
                        <a href="#">
                            <span class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="1.5em" fill="currentColor"
                                    class="bi bi-person" viewBox="0 0 16 16">
                                    <path
                                        d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z" />
                                </svg>
                            </span>

                            <span class="txt-link">Funcionários</span>
                        </a>
                    </li>
                    <li class="item-menu" id="cadFunc">
                        <a href="#">
                            <span class="icon">
                                <svg xmlns="http://www.w3.org/2000/svg" height="1.5em" fill="currentColor"
                                    class="bi bi-person-plus" viewBox="0 0 16 16">
                                    <path
                                        d="M6 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H1s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C9.516 10.68 8.289 10 6 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z" />
                                    <path fill-rule="evenodd"
                                        d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5z" />
                                </svg>
                            </span>

                            <span class="txt-link">Cadastrar</span>
                        </a>
                    </li>
                    <li class="item-menu" id="item-menu-sair" onclick="window.location.href='../index.html'">
                        <a href="#">
                            <span class="icon-sair">
                                <svg xmlns="http://www.w3.org/2000/svg" height="1.4em" fill="rgb(151, 16, 16)"
                                    class="bi bi-box-arrow-left" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd"
                                        d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z" />
                                    <path fill-rule="evenodd"
                                        d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z" />
                                </svg>
                            </span>
                            <span class="txt-link-sair">Sair</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </article>

        <article id="dash">
            <header id="header">
                <div id="titulosDash">
                    <h1 class="titulo">Dashboard</h1>
                    <h3 id="nome_empresa"></h3>
                </div>
                <section class="opcoesTopo">
                    <div id="notificacao">
                        <svg xmlns="http://www.w3.org/2000/svg" height="1.4em" viewBox="0 0 448 512">
                            <!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                            <path
                                d="M224 0c-17.7 0-32 14.3-32 32V51.2C119 66 64 130.6 64 208v18.8c0 47-17.3 92.4-48.5 127.6l-7.4 8.3c-8.4 9.4-10.4 22.9-5.3 34.4S19.4 416 32 416H416c12.6 0 24-7.4 29.2-18.9s3.1-25-5.3-34.4l-7.4-8.3C401.3 319.2 384 273.9 384 226.8V208c0-77.4-55-142-128-156.8V32c0-17.7-14.3-32-32-32zm45.3 493.3c12-12 18.7-28.3 18.7-45.3H224 160c0 17 6.7 33.3 18.7 45.3s28.3 18.7 45.3 18.7s33.3-6.7 45.3-18.7z" />
                        </svg>
                    </div>
                    <div id="usuario">
                        <svg xmlns="http://www.w3.org/2000/svg" height="1.4em" viewBox="0 0 448 512">
                            <!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                            <path
                                d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z" />
                        </svg>
                    </div>
                </section>
            </header>

            <section id="areaDash">
                <div class="kpiIniciais">
                    <div class="kpiInfo">
                        <p>Funcionários Ativos na SafeSync</p>
                        <span id="kpi1">18</span>
                    </div>
                    <div class="kpiInfo">
                        <p>N° de Tarefas Entregues - mês</p>
                        <span id="kpi2">310</span>
                    </div>
                    <div class="kpiInfo">
                        <p>N° de Tarefas atrasadas - mês</p>
                        <span id="kpi3">28</span>
                    </div>
                    <div class="kpiInfo">
                        <p>N° de Alertas das máquinas - dia</p>
                        <span id="kpi4">18</span>
                    </div>
                </div>
                <div class="kpiMaquinas">
                    <div class="maquinasInfo">
                        <div class="divisaoInfo">
                            <div class="legendaMaquinas">
                                <p>% de máquinas que passaram do limite de Ram:</p>
                            </div>
                            <div id="kpiMaquina1">
                                <span>55%</span>
                            </div>
                        </div>
                        <p class="limiteAlerta">Limite alerta: 60 - 70% de uso</p>
                    </div>
                    <div class="maquinasInfo">
                        <div class="divisaoInfo">
                            <div class="legendaMaquinas">
                                <p>% de máquinas que passaram do limite de disco:</p>
                            </div>
                            <div id="kpiMaquina2">
                                <span>55%</span>
                            </div>
                        </div>
                        <p class="limiteAlerta">Limite alerta: 60 - 70% de uso</p>
                    </div>
                    <div class="maquinasInfo">
                        <div class="divisaoInfo">
                            <div class="legendaMaquinas">
                                <p>% de máquinas que passaram do limite de CPU:</p>
                            </div>
                            <div id="kpiMaquina3">
                                <span>73%</span>
                            </div>
                        </div>
                        <p class="limiteAlerta">Limite alerta: 71%+ de uso</p>
                    </div>
                </div>

                <!-- Table -->
                <div class="containerTable">
                    <div class="tableFuncionario">
                        <h3>Funcionários que mais entregaram tarefas no último mês</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Posição</th>
                                    <th>Nome</th>
                                    <th>Total de Tarefas</th>
                                </tr>
                            </thead>
                            <tbody id="rank_funcionarios">
                            </tbody>
                        </table>
                    </div>
                </div>
                      
            </section>

            <section id="areaFuncionarios">
                <div id="topoFuncionarios">
                    <div>
                        <h1>Gestão de funcionários</h1>
                    </div>
                    <div>
                        <input type="text" placeholder="buscar..." />
                        <img src="../assets/img/iconeLupa.svg" alt="" />
                    </div>
                </div>
                <article id="infoFunc">
                    <div class="infosFuncionario">
                        <div class="task-input" style="display: none;">
                            <input type="text" id="taskInput" placeholder="Digite uma nova tarefa">
                            <button onclick="">Atribuir Tarefa</button>
                        </div>
                        <p class="labelFuncionario nomeFuncionario">Daniel Rios</p>
                        <p class="labelFuncionario cargo">
                            Cargo:
                            <svg style="display: none" class="iconeEditar" xmlns="http://www.w3.org/2000/svg" width="16"
                                height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                                <path
                                    d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                                <path fill-rule="evenodd"
                                    d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
                            </svg>
                        </p>
                        <p class="labelFuncionario tarefasAtribuidas">
                            Tarefas atribuidas: <span id="tarefasAtribuidas"> 11 </span>

                        </p>
                        <p class="labelFuncionario tarefasCompletas">
                            <span class="bordaVerde"> Tarefas Completas: <span id="tarefasCompletas"> 11 </span></span>

                        </p>
                        <p class="labelFuncionario tarefasAtrasadas">
                            <span class="bordaVermelha"> Tarefas Atrasadas: <span id="tarefasAtrasadas"> 0 </span>
                            </span>

                        </p>
                        <p class="labelFuncionario estadoMaquina">
                            Estado da Máquina: <span class="estadoMaquinaText estadoMaquina">Manutenção</span>
                        </p>
                        <p class="labelFuncionario usoMaquina">
                            Uso: <span class="usoMaquinaText usoMaquina">Off</span>
                        </p>
                        <p class="btnAbrirModalFuncionario">+</p>
                    </div>
                </article>
            </section>

            <section id="areaCadFunc">
                <div class="container">
                    <!-- <div class="separador"></div> -->
                    <div class="card_cadastro">
                        <div class="titulo_cadastro">Cadastro</div>
                        <div class="group_input primeiraGroupInputs">
                            <input id="input_nome" type="text" placeholder="Nome Completo" />
                        </div>
                        <div class="group_input">
                            <input id="input_cargo" type="text" placeholder="Cargo" />
                        </div>
                        <div class="group_input">
                            <input id="input_cpf" type="text" placeholder="CPF" />
                        </div>
                        <div class="group_input">
                            <input id="input_email" type="text" placeholder="Email" />
                        </div>
                        <div class="group_input">
                            <input id="input_telefone" type="text" placeholder="Telefone" />
                        </div>
                        <div class="group_input">
                            <input id="input_senha" type="password" placeholder="Senha" />
                        </div>
                        <div class="botao_cadastro">
                            <button onclick="cadastrarFuncionario()">Seguinte</button>
                        </div>
                    </div>
                </div>
            </section>

            <div id="modalNotificacao" class="notificacaoModal">
                <div class="notificacaoModal-content">
                    <span class="closeNotificacao">&times;</span>
                    <!-- Conteúdo do modal aqui -->
                    <!-- Seu conteúdo modal aqui... -->
                    <section>
                        <div class="notificacaoCritico">
                            <p>Uso da CPU crítico, acima dos 90%</p>
                        </div>
                        <div class="notificacaoBom">
                            <p>Uso da CPU bom, abaixo dos 50%</p>
                        </div>
                        <div class="notificacaoAlerta">
                            <p>Uso da CPU em alerta, acima dos 70%</p>
                        </div>
                        <div class="notificacaoBom">
                            <p>Usuário cumpriu suas tarefas</p>
                        </div>

                        <div class="notificacaoAlerta">
                            <p onclick="window.location.href='./dashFuncionario.html'">
                                Uso da CPU em alerta, acima dos 70%
                            </p>
                        </div>
                    </section>
                </div>
            </div>

            <div id="modalUsuario" class="usuarioModal">
                <div class="usuarioModal-content">
                    <span class="closeUsuario"></span>
                    <section>
                        <h1>Perfil Empresa</h1>

                        <article>
                            <div id="imgPerfil">
                                <img src="../assets/img/LogoSafeSync.svg" alt="" />
                            </div>

                            <div class="conteudoPerfil">
                                <div class="iconeEditarPerfil">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        class="bi bi-pencil-fill" viewBox="0 0 16 16">
                                        <path
                                            d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z" />
                                    </svg>
                                </div>
                                <p class="legendaPerfil primeiraLegenda">Nome</p>
                                <p class="campoPerfil" id="perfi_nomeEmpresa"></p>
                                <p class="legendaPerfil">Email</p>
                                <p class="campoPerfil" id="perfil_emailEmpresa"></p>
                                <p class="legendaPerfil">CNPJ</p>
                                <p class="campoPerfil" id="perfil_cnpj"></p>
                            </div>
                        </article>
                    </section>
                </div>
            </div>
        </article>
    </main>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.js"></script>
</body>

</html>
<script src="./script/dashEmpresa.js"></script>

<script>
    var idEmpresa = sessionStorage.ID_EMPRESA;
    var nomeEmpresa = sessionStorage.NOME_EMPRESA;
    var emailEmpresa = sessionStorage.EMAIL_EMPRESA;
    var cnpjEmpresa = sessionStorage.CNPJ;

    nome_empresa.innerHTML = nomeEmpresa;
    perfi_nomeEmpresa.innerHTML = nomeEmpresa;
    perfil_emailEmpresa.innerHTML = emailEmpresa;
    perfil_cnpj.innerHTML = cnpjEmpresa;


    $('#input_cpf').mask('000.000.000-00');
    $('#input_telefone').mask('(00)00000-0000')

    function listarFuncionarios() {
        fetch(`/kpiEmpresa/listarFuncionarios/${idEmpresa}`).then(function (response) {
            if (response.ok) {
                response.json().then(function (funcionarios) {

                    for (i = 0; i < funcionarios.length; i++) {
                        var nomeAtual = funcionarios[i].nomeFuncionario;
                        var tarefasEntregues = funcionarios[i].totalTarefasConcluidas

                        rank_funcionarios.innerHTML += `
                    <tr>
                        <td>${i + 1}</td>
                        <td>${nomeAtual}</td>
                        <td>${tarefasEntregues}</td>
                    </tr>
                    `
                    }
                });
            } else {
                console.error('Nenhuma tarefa encontrada ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados: ${error.message}`);
            });

    }
    listarFuncionarios()

    function funcionariosAtivos() {
        fetch(`/kpiEmpresa/funcionariosAtivos/${idEmpresa}`).then(function (response) {
            if (response.ok) {
                response.json().then(function (funcionarios) {

                    for (i = 0; i < funcionarios.length; i++) {
                        kpi1.innerHTML = funcionarios[i].quantidade_funcionarios;
                    }

                });
            } else {
                console.error('Nenhuma funcionario encontrada ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados: ${error.message}`);
            });
    }
    funcionariosAtivos()
    function TarefasEntreguesMes() {
        fetch(`/kpiEmpresa/tarefasEntreguesMes/${idEmpresa}`).then(function (response) {
            if (response.ok) {
                response.json().then(function (funcionarios) {

                    for (i = 0; i < funcionarios.length; i++) {
                        kpi2.innerHTML = funcionarios[i].totalTarefasEntregues;
                    }

                });
            } else {
                console.error('Nenhuma funcionario encontrada ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados: ${error.message}`);
            });
    }
    TarefasEntreguesMes()

    console.log(sessionStorage.ID_EMPRESA);
    function cadastrarFuncionario() {
        var nomeVar = input_nome.value;
        var cargoVar = input_cargo.value;
        var cpfVar = input_cpf.value;
        var emailVar = input_email.value;
        var telefoneVar = input_telefone.value;
        var senhaVar = input_senha.value;
        var idEmpresaVar = sessionStorage.ID_EMPRESA;

        console.log(idEmpresaVar);

        fetch("/empresa/cadastrarFuncionario", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                nomeServer: nomeVar,
                cargoServer: cargoVar,
                cpfServer: cpfVar,
                emailServer: emailVar,
                telefoneServer: telefoneVar,
                senhaServer: senhaVar,
                idEmpresaServer: idEmpresaVar
            }),
        })
            .then(function (resposta) {
                if (resposta.ok) {
                    // funcionário cadastrado
                    location.reload();

                    input_nome.value = "";
                    input_cargo.value = "";
                    input_cpf.value = "";
                    input_email.value = "";
                    input_telefone.value = "";
                    input_senha.value = "";

                } else {
                    console.log("Erro ao fazer o cadastro");
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
        return false;
    }
    
</script>